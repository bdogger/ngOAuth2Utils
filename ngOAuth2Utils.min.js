/*! ngOAuth2Utils 2015-02-21 */
"use strict";!function(){angular.module("ngOAuth2Utils",["ngStorage"]).constant("oauthConfig",{getAccessTokenUrl:"",base64BasicKey:"",revokeTokenUrl:"",loginPath:"",interceptorIgnorePattern:/ /,storageType:"session"}).config(["$httpProvider",function(a){a.interceptors.push("$httpInterceptorService")}]).run(function(a,b,c,d,e){b.isValidAndExpiredToken()?c.refresh():b.isValidToken()||a.path(e.loginPath),d.$on("$routeChangeStart",function(c){b.isValidToken()||(c.preventDefault(),a.path(e.loginPath))})}),angular.module("ngOAuth2Utils").factory("$authenticationService",function(a,b,c){function d(a){b.setToken(a.access_token),b.setExpiresIn(a.expires_in),b.setRefreshToken(a.refresh_token)}return{login:function(e,f){return a({method:"GET",url:c.getAccessTokenUrl,headers:{Authorization:"Basic "+c.base64BasicKey},params:{grant_type:"password",password:f,username:e}}).success(function(a){d(a)}).error(function(){b.reset()})},refresh:function(){return a({method:"GET",url:c.getAccessTokenUrl,headers:{Authorization:"Basic "+c.base64BasicKey},params:{refresh_token:b.getRefreshToken(),grant_type:"refresh_token"}}).success(function(a){d(a)})},logout:function(){return a({method:"DELETE",url:c.revokeTokenUrl,headers:{Authorization:"Bearer "+b.getToken()}}).success(function(){b.reset()})}}}),angular.module("ngOAuth2Utils").factory("$httpInterceptorService",function(a,b,c,d){return{request:function(a){return a.url.match(d.interceptorIgnorePattern)||null==c.getToken()||(a.headers.Authorization="Bearer "+c.getToken()),a},responseError:function(e){return(401===e.status||400===e.status&&"refresh_token"===e.config.params.grant_type)&&(c.reset(),b.path(d.loginPath)),a.reject(e)}}}),angular.module("ngOAuth2Utils").factory("storageService",function(a,b,c){return{getStorage:function(){return"local"===c.storageType?b:a}}}),angular.module("ngOAuth2Utils").factory("$tokenService",function(a){return{getToken:function(){return a.getStorage().token},setToken:function(b){a.getStorage().token=b},setExpiresIn:function(b){a.getStorage().expiresIn=new Date((new Date).valueOf()+1e3*b)},isValidToken:function(){return null==this.getToken()||null==a.getStorage().expiresIn||a.getStorage().expiresIn.valueOf()<(new Date).valueOf()?!1:!0},isValidAndExpiredToken:function(){return null!=this.getToken()&&null!=this.getRefreshToken()&&null!=a.getStorage().expiresIn&&(new Date).valueOf()<a.getStorage().expiresIn.valueOf()?!0:!1},setRefreshToken:function(b){a.getStorage().refreshToken=b},getRefreshToken:function(){return a.getStorage().refreshToken},reset:function(){this.setToken(null),this.setRefreshToken(null),a.getStorage().expiresIn=null}}})}();